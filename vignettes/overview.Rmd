---
title: "Overview of the rpathsonpaths package"
author: "Martin Hinsch"
date: "`r Sys.Date()`"
output:
   rmarkdown::html_vignette:
     toc: true
     toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  fig.width=7, 
  fig.height=5, 
  fig.path="figs-overview/"
)
```


*rpathsonpaths* provides functions to simulate the spread of biological organisms on a substrate that is itself moving through a network structure (e.g. pathogens in a food distribution network or infections in migrating animals). This vignette provides an overview of current features. It largely reproduces the
content of `REAME.md`.



<br>

# Installing the package

*rpathsonpaths* is currently only available on github.

```{r install2, eval=FALSE}
devtools::install_github("reconhub/incidence")
```

Note that this requires the package *devtools* to be installed.



<br>

# What does it do?


*rpathsonpaths* provides functions to simulate the spread of a population in a substrate that itself is transported across
a directed graph. The paradigmatic example is the spread of pathogens in food transport networks, but other instances might
include for examples infections in migrating animals.


The most important functions include:

- **`PopsNetwork`**: create a network object from an edgelist (describing the transport graph) and a list of external sources.

- **`setAlleleFreq`**: set the population composition in source nodes.

- **`spreadDirichlet`**: simulate spread of genetic material on the network using a Dirichlet distribution to approximate genetic drift.

- **`drawIsolates`**: draw a number of random individuals from a set of nodes using the simulated allele frequencies.

- **`plot`**: plot a *PopsNetwork* object (currently uses *igraph*, but more backends are planned).


<br>

# A quick overview

The following worked example provides a brief overview of the package's
functionalities. 


## Preparing the network


First, we prepare an edge list describing the network, and the initial state of the source nodes:

```{r, prepare}
library(rpathsonpaths)

inp <- c(0, 0, 1, 2, 3, 1, 5)
outp <- c(1, 2, 3, 3, 4, 4, 2)
rates <- c(1, 1.5, 0.5, 0.1, 1, 0.1, 0.5)
edgelist <- data.frame(inputs=inp, outputs=outp, rates=rates)
ext <- data.frame(nodes=c(0, 5), rates=c(0.5, 0.5))

```

Now we can create a *PopsNetwork* object:

```{r, popsnetwork}

netraw <- PopsNetwork(edgelist, ext, 0.1)
netraw
plot(netraw)

```


## Injecting initial populations and simulating spread

We set up the initial populations of the source nodes:

```{r, inipop}
freqs <- matrix(c(0.1, 0.4, 0.3, 0.1, 0.2, 0.2, 0.4, 0.3), ncol=4, nrow=2)
netini <- setAlleleFreqs(netraw, list(nodes=c(0, 5), frequencies=freqs))
netini

```

Now we are ready to simulate spread of genetic material in the network. Note that every call to spreadDirichlet
will generally produce a different allele frequency distribution.

```{r, dirichlet}
netdir1 <- spreadDirichlet(netini, 1.7)
netdir1
netdir2 <- spreadDirichlet(netini, 1.7)
netdir2
```


## Drawing samples

Finally we can draw samples from our simulated population.

```{r, isolates}
samplconf <- data.frame(nodes=c(2, 4), N=c(10, 10))
drawIsolates(netdir1, samplconf)
drawIsolates(netdir2, samplconf)

```

