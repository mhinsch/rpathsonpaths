<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview of the rpathsonpaths package • rpathsonpaths</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rpathsonpaths</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/hacking.html">Extending rpathsonpaths</a>
    </li>
    <li>
      <a href="../articles/overview.html">Overview of the rpathsonpaths package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mhinsch/rpathsonpaths">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Overview of the rpathsonpaths package</h1>
                        <h4 class="author">Martin Hinsch</h4>
            
            <h4 class="date">2017-11-28</h4>
          </div>

    
    
<div class="contents">
<p><em>rpathsonpaths</em> provides functions to simulate the spread of biological organisms on a substrate that is itself moving through a network structure (e.g. pathogens in a food distribution network or infections in migrating animals). This vignette provides an overview of current features. It largely reproduces the content of <code>REAME.md</code>.</p>
<p><br></p>
<div id="installing-the-package" class="section level1">
<h1 class="hasAnchor">
<a href="#installing-the-package" class="anchor"></a>Installing the package</h1>
<p><em>rpathsonpaths</em> is currently only available on github.</p>
<p>Prerequisites:</p>
<ul>
<li><p>C++ boost libraries</p></li>
<li><p><em>Rcpp</em> (&gt;= 0.12.9)</p></li>
</ul>
<p>Some of the functionality will also require the <em>igraph</em> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">install_github</span>(<span class="st">"reconhub/incidence"</span>)</code></pre></div>
<p>Note that this requires the package <em>devtools</em> to be installed.</p>
<p><br></p>
</div>
<div id="what-does-it-do" class="section level1">
<h1 class="hasAnchor">
<a href="#what-does-it-do" class="anchor"></a>What does it do?</h1>
<p><em>rpathsonpaths</em> provides functions to simulate the spread of a population in a substrate that itself is transported across a directed graph. The paradigmatic example is the spread of pathogens in food transport networks, but other instances might include for examples infections in migrating animals.</p>
<p>The most important functions include:</p>
<ul>
<li><p><strong><code>popsnetwork</code></strong>: create a network object from an edgelist (describing the transport graph) and a list of external sources.</p></li>
<li><p><strong><code>set_allele_freq</code></strong>: set the population composition in source nodes.</p></li>
<li><p><strong><code>popgen_dirichlet</code></strong>: simulate spread of genetic material on the network using a Dirichlet distribution to approximate genetic drift.</p></li>
<li><p><strong><code>draw_isolates</code></strong>: draw a number of random individuals from a set of nodes using the simulated allele frequencies.</p></li>
<li><p><strong><code>plot</code></strong>: plot a <em>popsnetwork</em> object (currently uses <em>igraph</em>, but more backends are planned).</p></li>
</ul>
<p><br></p>
</div>
<div id="a-quick-overview" class="section level1">
<h1 class="hasAnchor">
<a href="#a-quick-overview" class="anchor"></a>A quick overview</h1>
<p>The following worked example provides a brief overview of the package’s functionalities.</p>
<div id="preparing-the-network" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-the-network" class="anchor"></a>Preparing the network</h2>
<p>First, we prepare an edge list describing the network, and the initial state of the source nodes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rpathsonpaths)

<span class="co"># from nodes</span>
inp &lt;-<span class="st"> </span><span class="kw">c</span>(0L, 0L, 1L, 2L, 3L, 1L, 5L)
<span class="co"># to nodes</span>
outp &lt;-<span class="st"> </span><span class="kw">c</span>(1L, 2L, 3L, 3L, 4L, 4L, 2L)
<span class="co"># rate of transport, this is optional</span>
rates &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>)
edgelist &lt;-<span class="st"> </span><span class="kw">data.frame</span>(inp, outp, rates)</code></pre></div>
<p>We have to provide some external input into the network (otherwise the simulation will be quite boring). In this case we only give the IDs of the input nodes and the (absolute) amount of infected material which means 1 will be assumed for net input rates (infected + uninfected). This is fine since we intend to run the Dirichlet model so absolute numbers are irrelevant. If we wanted to run the mechanistic model we would need both sets of numbers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># external input (node IDS, infected input)</span>
ext &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">c</span>(0L, 5L), <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</code></pre></div>
<p>Now we can create a <em>popsnetwork</em> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create network using infection rate (within nodes) of 0.1</span>
<span class="co"># this already calculates the amount of infected/unifected for</span>
<span class="co"># all nodes</span>
netraw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/popsnetwork.html">popsnetwork</a></span>(edgelist, ext, <span class="fl">0.1</span>)
netraw
<span class="co">#&gt; Nodes:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; id   infected    input   alleles...</span>
<span class="co">#&gt; 0    0.55    1</span>
<span class="co">#&gt; 1    0.595   1</span>
<span class="co">#&gt; 2    0.595   2</span>
<span class="co">#&gt; 3    0.6355  0.6</span>
<span class="co">#&gt; 4    0.668636    1.1</span>
<span class="co">#&gt; 5    0.55    1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Links:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; from to  rate    infected</span>
<span class="co">#&gt; 0    1   1   0.55</span>
<span class="co">#&gt; 0    2   1.5 0.55</span>
<span class="co">#&gt; 1    3   0.5 0.595</span>
<span class="co">#&gt; 2    3   0.1 0.595</span>
<span class="co">#&gt; 3    4   1   0.6355</span>
<span class="co">#&gt; 1    4   0.1 0.595</span>
<span class="co">#&gt; 5    2   0.5 0.55</span>
<span class="kw">plot</span>(netraw)
<span class="co">#&gt; Loading required namespace: igraph</span></code></pre></div>
<p><img src="figs-overview/popsnetwork-1.png" width="672"></p>
<p>We have now set up the network topology and determined the amount of infected and uninfected material in each node. In the next step we have to set allele frequencies at the input nodes. Then we can run the simulation to obtain genetic composisition at the leaf nodes.</p>
</div>
<div id="injecting-initial-populations-and-simulating-spread" class="section level2">
<h2 class="hasAnchor">
<a href="#injecting-initial-populations-and-simulating-spread" class="anchor"></a>Injecting initial populations and simulating spread</h2>
<p>We set up the initial genetic composition of the input nodes. In this case we assume all root nodes have external input.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># allele frequencies, rows=nodes, columns=alleles</span>
freqs &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>), <span class="dt">ncol=</span><span class="dv">4</span>, <span class="dt">nrow=</span><span class="dv">2</span>)
netini &lt;-<span class="st"> </span><span class="kw"><a href="../reference/set_allele_freqs.html">set_allele_freqs</a></span>(netraw, <span class="kw">list</span>(<span class="kw">c</span>(0L, 5L), freqs))
netini
<span class="co">#&gt; Nodes:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; id   infected    input   alleles...</span>
<span class="co">#&gt; 0    0.55    1   0.1 0.3 0.2 0.4</span>
<span class="co">#&gt; 1    0.595   1   0   0   0   0</span>
<span class="co">#&gt; 2    0.595   2   0   0   0   0</span>
<span class="co">#&gt; 3    0.6355  0.6 0   0   0   0</span>
<span class="co">#&gt; 4    0.668636    1.1 0   0   0   0</span>
<span class="co">#&gt; 5    0.55    1   0.4 0.1 0.2 0.3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Links:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; from to  rate    infected</span>
<span class="co">#&gt; 0    1   1   0.55</span>
<span class="co">#&gt; 0    2   1.5 0.55</span>
<span class="co">#&gt; 1    3   0.5 0.595</span>
<span class="co">#&gt; 2    3   0.1 0.595</span>
<span class="co">#&gt; 3    4   1   0.6355</span>
<span class="co">#&gt; 1    4   0.1 0.595</span>
<span class="co">#&gt; 5    2   0.5 0.55</span></code></pre></div>
<p>Now we are ready to simulate spread of genetic material in the network. Note that every call to popgen_dirichlet will generally produce a different allele frequency distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># simulate with a theta of 1.7</span>
netdir1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/popgen_dirichlet.html">popgen_dirichlet</a></span>(netini, <span class="fl">1.7</span>)
netdir1
<span class="co">#&gt; Nodes:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; id   infected    input   alleles...</span>
<span class="co">#&gt; 0    0.55    1   0.1 0.3 0.2 0.4</span>
<span class="co">#&gt; 1    0.595   1   0.166885    0.344565    0.0574816   0.431068</span>
<span class="co">#&gt; 2    0.595   2   0.0643937   0.136638    0.411443    0.387525</span>
<span class="co">#&gt; 3    0.6355  0.6 0.154391    0.0772379   0.243571    0.5248</span>
<span class="co">#&gt; 4    0.668636    1.1 0.023551    0.0667924   0.732609    0.177048</span>
<span class="co">#&gt; 5    0.55    1   0.4 0.1 0.2 0.3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Links:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; from to  rate    infected</span>
<span class="co">#&gt; 0    1   1   0.55</span>
<span class="co">#&gt; 0    2   1.5 0.55</span>
<span class="co">#&gt; 1    3   0.5 0.595</span>
<span class="co">#&gt; 2    3   0.1 0.595</span>
<span class="co">#&gt; 3    4   1   0.6355</span>
<span class="co">#&gt; 1    4   0.1 0.595</span>
<span class="co">#&gt; 5    2   0.5 0.55</span>
netdir2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/popgen_dirichlet.html">popgen_dirichlet</a></span>(netini, <span class="fl">1.7</span>)
netdir2
<span class="co">#&gt; Nodes:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; id   infected    input   alleles...</span>
<span class="co">#&gt; 0    0.55    1   0.1 0.3 0.2 0.4</span>
<span class="co">#&gt; 1    0.595   1   4.17151e-05 0.329058    0.0983984   0.572502</span>
<span class="co">#&gt; 2    0.595   2   0.0491974   0.0993721   0.695952    0.155478</span>
<span class="co">#&gt; 3    0.6355  0.6 0.00149107  0.62733 0.112971    0.258208</span>
<span class="co">#&gt; 4    0.668636    1.1 2.8255e-35  0.31049 0.624502    0.0650084</span>
<span class="co">#&gt; 5    0.55    1   0.4 0.1 0.2 0.3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Links:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; from to  rate    infected</span>
<span class="co">#&gt; 0    1   1   0.55</span>
<span class="co">#&gt; 0    2   1.5 0.55</span>
<span class="co">#&gt; 1    3   0.5 0.595</span>
<span class="co">#&gt; 2    3   0.1 0.595</span>
<span class="co">#&gt; 3    4   1   0.6355</span>
<span class="co">#&gt; 1    4   0.1 0.595</span>
<span class="co">#&gt; 5    2   0.5 0.55</span></code></pre></div>
</div>
<div id="drawing-samples" class="section level2">
<h2 class="hasAnchor">
<a href="#drawing-samples" class="anchor"></a>Drawing samples</h2>
<p>Finally we can draw samples from our simulated population.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 10 samples from nodes 2 and 4</span>
samplconf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">c</span>(2L, 4L), <span class="kw">c</span>(10L, 10L))
<span class="kw"><a href="../reference/draw_isolates.html">draw_isolates</a></span>(netdir1, samplconf)
<span class="co">#&gt;   node allele_0 allele_1 allele_2 allele_3</span>
<span class="co">#&gt; 1    2        1        2        3        4</span>
<span class="co">#&gt; 2    4        1        2        6        1</span>
<span class="kw"><a href="../reference/draw_isolates.html">draw_isolates</a></span>(netdir2, samplconf)
<span class="co">#&gt;   node allele_0 allele_1 allele_2 allele_3</span>
<span class="co">#&gt; 1    2        1        2        6        1</span>
<span class="co">#&gt; 2    4        0        3        6        1</span></code></pre></div>
</div>
</div>
<div id="an-example-using-real-data" class="section level1">
<h1 class="hasAnchor">
<a href="#an-example-using-real-data" class="anchor"></a>An example using real data</h1>
<div id="obtain-and-clean-up-data" class="section level2">
<h2 class="hasAnchor">
<a href="#obtain-and-clean-up-data" class="anchor"></a>Obtain and clean up data</h2>
<p>Let’s load the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(outbreaks)
<span class="kw">data</span>(s_enteritidis_pt59)
<span class="co"># outbreaks stores node lists as string vectors...</span>
raw_graph =<span class="st"> </span>s_enteritidis_pt59$graph
<span class="co"># ...but putting them into a dataframe will convert them to factors</span>
sent_graph =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">from=</span>raw_graph[[<span class="dv">1</span>]], <span class="dt">to=</span>raw_graph[[<span class="dv">2</span>]])</code></pre></div>
<p>Just in case we do some sanity checks.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rpathsonpaths)
<span class="co"># check for separate subnetworks</span>
<span class="kw"><a href="../reference/colour_network.html">colour_network</a></span>(sent_graph)
<span class="co">#&gt;   [1] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span>
<span class="co">#&gt;  [36] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span>
<span class="co">#&gt;  [71] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span>
<span class="co"># check for cycles</span>
<span class="kw"><a href="../reference/cycles.html">cycles</a></span>(sent_graph)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Ok, we do have one contiguous network. Unfortunately, however, there’s a cycle. This will make rpathsonpaths very unhappy so we have to get rid of it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># output cycles</span>
<span class="kw"><a href="../reference/cycles.html">cycles</a></span>(sent_graph, <span class="ot">TRUE</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 0b6e5a 13dc78</span>
<span class="co">#&gt; 98 Levels: 2e7967 cd48bf dd73b6 7ba446 642cb4 c7cd02 5b44d7 ... 486c07</span>
sent_graph2 &lt;-<span class="st"> </span><span class="kw">subset</span>(sent_graph, !(from==<span class="st">"13dc78"</span> &amp;<span class="st"> </span>to==<span class="st">"0b6e5a"</span>))
<span class="co"># success?</span>
<span class="kw"><a href="../reference/cycles.html">cycles</a></span>(sent_graph2)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
</div>
<div id="create-network" class="section level2">
<h2 class="hasAnchor">
<a href="#create-network" class="anchor"></a>Create network</h2>
<p>Ok, this is solved. Now let’s see how many root nodes we have in the network.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sg_sources &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sources.html">sources</a></span>(sent_graph2)
sg_sources
<span class="co">#&gt; [1] 2e7967 fc7f8f 53d0b4 3301f4 c190fa d2d08f 238842</span>
<span class="co">#&gt; 98 Levels: 2e7967 cd48bf dd73b6 7ba446 642cb4 c7cd02 5b44d7 ... 486c07</span></code></pre></div>
<p>In order to be able to construct a popsnetwork object we have to provide at least the rate of input of infected material for each source.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># this is the lazy way</span>
sg_ext &lt;-<span class="st"> </span><span class="kw">data.frame</span>(sg_sources, <span class="kw">rep</span>(<span class="fl">0.5</span>, <span class="kw">length</span>(sg_sources)))
sg_ext
<span class="co">#&gt;   sg_sources rep.0.5..length.sg_sources..</span>
<span class="co">#&gt; 1     2e7967                          0.5</span>
<span class="co">#&gt; 2     fc7f8f                          0.5</span>
<span class="co">#&gt; 3     53d0b4                          0.5</span>
<span class="co">#&gt; 4     3301f4                          0.5</span>
<span class="co">#&gt; 5     c190fa                          0.5</span>
<span class="co">#&gt; 6     d2d08f                          0.5</span>
<span class="co">#&gt; 7     238842                          0.5</span></code></pre></div>
<p>Now we can create the network.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># some mild infection within nodes</span>
sg_net &lt;-<span class="st"> </span><span class="kw"><a href="../reference/popsnetwork.html">popsnetwork</a></span>(sent_graph2, sg_ext, <span class="fl">0.1</span>)
<span class="kw">plot</span>(sg_net)</code></pre></div>
<p><img src="figs-overview/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div id="run-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#run-simulation" class="anchor"></a>Run simulation</h2>
<p>The only thing left to do in order to run the simulation is to provide initial allele frequency distributions for the source nodes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># it's just an example so let's make things easy</span>
sg_freqs &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>), <span class="dt">each=</span><span class="dv">7</span>), <span class="dt">nrow=</span><span class="dv">7</span>)
<span class="co"># we can provide allele frequencies when calling the simulation</span>
sg_net_dir &lt;-<span class="st"> </span><span class="kw"><a href="../reference/popgen_dirichlet.html">popgen_dirichlet</a></span>(sg_net, <span class="fl">1.3</span>, <span class="kw">list</span>(sg_sources, sg_freqs))
sg_net_dir
<span class="co">#&gt; Nodes:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; id   infected    input   alleles...</span>
<span class="co">#&gt; 2e7967   0.55    1   0.25    0.25    0.5</span>
<span class="co">#&gt; cd48bf   0.595   1   6.32801e-06 0.0253003   0.974693</span>
<span class="co">#&gt; dd73b6   0.595   2   0.510551    0.0840311   0.405418</span>
<span class="co">#&gt; 7ba446   0.595   1   0.0132531   0.917562    0.0691849</span>
<span class="co">#&gt; 642cb4   0.6355  1   0.0280048   5.03936e-10 0.971995</span>
<span class="co">#&gt; c7cd02   0.595   2   0.103493    0.37495 0.521557</span>
<span class="co">#&gt; 5b44d7   0.64765 1   3.66969e-05 1.78682e-05 0.999945</span>
<span class="co">#&gt; 2afba4   0.6085  3   0.200306    0.122066    0.677628</span>
<span class="co">#&gt; fc7f8f   0.55    1   0.25    0.25    0.5</span>
<span class="co">#&gt; 963c41   0.714597    1   0   0   1</span>
<span class="co">#&gt; f60e85   0.659193    1   0.0660577   0.0335136   0.900429</span>
<span class="co">#&gt; 4941c6   0.693273    1   0.000119701 1.08604e-06 0.999879</span>
<span class="co">#&gt; 53d0b4   0.55    1   0.25    0.25    0.5</span>
<span class="co">#&gt; 13dc78   0.67195 1   0.999348    0.000651901 2.59314e-60</span>
<span class="co">#&gt; 9c0e59   0.6355  1   0.0114908   0.253663    0.734846</span>
<span class="co">#&gt; 6ddfa3   0.704755    1   0   0   1</span>
<span class="co">#&gt; 3301f4   0.55    1   0.25    0.25    0.5</span>
<span class="co">#&gt; 874918   0.6355  1   0.316676    8.28473e-12 0.683324</span>
<span class="co">#&gt; f46d1e   0.6355  1   0.0142476   4.81163e-39 0.985752</span>
<span class="co">#&gt; 0b6e5a   0.6355  1   0.958476    0.0393828   0.00214082</span>
<span class="co">#&gt; c190fa   0.55    1   0.25    0.25    0.5</span>
<span class="co">#&gt; 337cac   0.6355  2   0.110006    0.408577    0.481417</span>
<span class="co">#&gt; 03eee3   0.595   1   0.487428    0.298085    0.214487</span>
<span class="co">#&gt; c1dc98   0.64765 1   0.898261    0.0636236   0.0381149</span>
<span class="co">#&gt; a7a903   0.734279    1   0   0   1</span>
<span class="co">#&gt; d2d08f   0.55    1   0.25    0.25    0.5</span>
<span class="co">#&gt; 030327   0.64765 1   0.000631337 0.000465732 0.998903</span>
<span class="co">#&gt; 6d4b91   0.595   1   0.112968    0.365641    0.521391</span>
<span class="co">#&gt; 76a432   0.682885    1   0.999999    1.74602e-16 6.04361e-07</span>
<span class="co">#&gt; 7fa3b1   0.6355  1   0.0155357   2.66263e-155    0.984464</span>
<span class="co">#&gt; f83f2e   0.6355  1   4.2226e-17  1   4.25624e-12</span>
<span class="co">#&gt; 881955   0.595   1   0.506356    0.00672551  0.486918</span>
<span class="co">#&gt; e42c72   0.6355  1   0   1.17848e-05 0.999988</span>
<span class="co">#&gt; 4df851   0.595   1   0.0243915   0.943936    0.0316729</span>
<span class="co">#&gt; d4d75e   0.6355  1   0.0461051   0.0211588   0.932736</span>
<span class="co">#&gt; 7be343   0.67195 1   0.174241    4.66915e-30 0.825759</span>
<span class="co">#&gt; 735807   0.64765 1   0.00745688  0.305554    0.686989</span>
<span class="co">#&gt; 238842   0.55    1   0.25    0.25    0.5</span>
<span class="co">#&gt; 3e93ce   0.595   1   0.10445 0.614884    0.280666</span>
<span class="co">#&gt; f7fc94   0.682885    1   0   0   1</span>
<span class="co">#&gt; 8e02f0   0.6355  1   0.348129    0.000633395 0.651238</span>
<span class="co">#&gt; b16cf0   0.64765 1   0.280281    4.85714e-06 0.719714</span>
<span class="co">#&gt; 51ca98   0.682885    1   0.0144599   0   0.98554</span>
<span class="co">#&gt; 81e071   0.665268    2   0.509788    4.11157e-07 0.490211</span>
<span class="co">#&gt; dc72e8   0.714597    1   0   0   1</span>
<span class="co">#&gt; 4e2918   0.6355  1   0.342078    0.592961    0.0649607</span>
<span class="co">#&gt; 2fabc7   0.682885    1   0   0   1</span>
<span class="co">#&gt; ad208a   0.595   1   0.149495    0.0512014   0.799303</span>
<span class="co">#&gt; 48f980   0.595   2   0.156493    0.495983    0.347524</span>
<span class="co">#&gt; 24dba7   0.682885    1   0.571963    6.8014e-276 0.428037</span>
<span class="co">#&gt; 327734   0.67195 1   7.09588e-21 0   1</span>
<span class="co">#&gt; 4e8dc8   0.67195 1   0   0   1</span>
<span class="co">#&gt; 206e37   0.64765 1   0.495198    0.000975715 0.503826</span>
<span class="co">#&gt; 958de8   0.621325    2   0.351469    0.0192196   0.629312</span>
<span class="co">#&gt; 2d3187   0.595   1   0.746502    0.0102232   0.243275</span>
<span class="co">#&gt; 7d21f1   0.6085  3   0.0598012   0.123804    0.816395</span>
<span class="co">#&gt; acf7bb   0.743137    1   0   0   1</span>
<span class="co">#&gt; 9f5aad   0.743137    1   0   0   1</span>
<span class="co">#&gt; 0b57e4   0.723946    1   0   0   1</span>
<span class="co">#&gt; 78e5ba   0.704755    1   1   0   0</span>
<span class="co">#&gt; ca432a   0.704755    1   1   3.95218e-159    0</span>
<span class="co">#&gt; e45c54   0.704755    1   1   1.05428e-231    0</span>
<span class="co">#&gt; 80afad   0.685345    2   0.0651774   0.0801991   0.854624</span>
<span class="co">#&gt; cede47   0.67195 1   0.0150841   0   0.984916</span>
<span class="co">#&gt; 82b4fc   0.67195 1   0.00116154  0   0.998838</span>
<span class="co">#&gt; 732379   0.67195 1   0.00334482  0   0.996655</span>
<span class="co">#&gt; 9199be   0.67195 1   0.22297 0   0.77703</span>
<span class="co">#&gt; 7d3df0   0.67195 1   0.0941818   0   0.905818</span>
<span class="co">#&gt; c77a84   0.67195 1   4.39978e-08 0.974338    0.0256616</span>
<span class="co">#&gt; 6f5824   0.67195 1   0.258531    0.731948    0.00952139</span>
<span class="co">#&gt; 3b712b   0.760852    1   0   0   1</span>
<span class="co">#&gt; 1e7431   0.682885    1   4.11022e-77 0   1</span>
<span class="co">#&gt; 37aad9   0.682885    1   2.28993e-13 1.21593e-94 1</span>
<span class="co">#&gt; 44060b   0.714597    1   1   0   0</span>
<span class="co">#&gt; 905296   0.714597    1   1   0   0</span>
<span class="co">#&gt; f951d8   0.714597    1   1   0   0</span>
<span class="co">#&gt; b4e5d5   0.714597    1   1   0   0</span>
<span class="co">#&gt; 1b55d2   0.67195 1   1.33545e-70 0   1</span>
<span class="co">#&gt; a6fcaf   0.67195 1   0   1   0</span>
<span class="co">#&gt; 24876f   0.704755    1   0.00553363  0   0.994466</span>
<span class="co">#&gt; 0fffca   0.682885    1   4.75716e-15 0.0403929   0.959607</span>
<span class="co">#&gt; 09f4a0   0.6355  1   1.65258e-07 0.999602    0.00039802</span>
<span class="co">#&gt; 38881f   0.67195 1   0.0347451   8.62898e-90 0.965255</span>
<span class="co">#&gt; d81c17   0.67195 1   0.841835    3.28559e-208    0.158165</span>
<span class="co">#&gt; 1569a5   0.67195 1   0.128748    5.81758e-48 0.871252</span>
<span class="co">#&gt; 064974   0.67195 1   0.0291172   1.22678e-36 0.970883</span>
<span class="co">#&gt; 161814   0.67195 1   0.89394 0   0.10606</span>
<span class="co">#&gt; c09e12   0.67195 1   0.0618155   7.70006e-165    0.938184</span>
<span class="co">#&gt; b08945   0.714597    1   0.00203391  0   0.997966</span>
<span class="co">#&gt; f80b2e   0.714597    1   1.34319e-138    0   1</span>
<span class="co">#&gt; 35a9b6   0.698741    1   0.970778    0   0.0292221</span>
<span class="co">#&gt; 6e0643   0.698741    1   0.44286 0   0.55714</span>
<span class="co">#&gt; efee6b   0.698741    1   0.112902    0   0.887098</span>
<span class="co">#&gt; 252679   0.698741    1   0.20938 0   0.79062</span>
<span class="co">#&gt; f59e4b   0.743137    1   0   0   1</span>
<span class="co">#&gt; ef7028   0.67195 1   0.494987    0.504949    6.41021e-05</span>
<span class="co">#&gt; 1f4d22   0.714597    1   0.397071    0   0.602929</span>
<span class="co">#&gt; 486c07   0.704755    1   0   0   1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Links:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; from to  rate    infected</span>
<span class="co">#&gt; 2e7967   dd73b6  1   0.55</span>
<span class="co">#&gt; 2e7967   c7cd02  1   0.55</span>
<span class="co">#&gt; 2e7967   2afba4  1   0.55</span>
<span class="co">#&gt; 2e7967   4df851  1   0.55</span>
<span class="co">#&gt; 2e7967   48f980  1   0.55</span>
<span class="co">#&gt; 2e7967   2d3187  1   0.55</span>
<span class="co">#&gt; cd48bf   e42c72  1   0.595</span>
<span class="co">#&gt; cd48bf   7d21f1  1   0.595</span>
<span class="co">#&gt; dd73b6   874918  1   0.595</span>
<span class="co">#&gt; 7ba446   f83f2e  1   0.595</span>
<span class="co">#&gt; 642cb4   327734  1   0.6355</span>
<span class="co">#&gt; c7cd02   337cac  1   0.595</span>
<span class="co">#&gt; 5b44d7   f7fc94  1   0.64765</span>
<span class="co">#&gt; 5b44d7   2fabc7  1   0.64765</span>
<span class="co">#&gt; 2afba4   5b44d7  1   0.6085</span>
<span class="co">#&gt; 2afba4   c1dc98  1   0.6085</span>
<span class="co">#&gt; 2afba4   b16cf0  1   0.6085</span>
<span class="co">#&gt; 2afba4   206e37  1   0.6085</span>
<span class="co">#&gt; 2afba4   958de8  1   0.6085</span>
<span class="co">#&gt; fc7f8f   dd73b6  1   0.55</span>
<span class="co">#&gt; 963c41   acf7bb  1   0.714597</span>
<span class="co">#&gt; 963c41   9f5aad  1   0.714597</span>
<span class="co">#&gt; f60e85   4941c6  1   0.659193</span>
<span class="co">#&gt; 4941c6   0b57e4  1   0.693273</span>
<span class="co">#&gt; 53d0b4   c7cd02  1   0.55</span>
<span class="co">#&gt; 13dc78   78e5ba  1   0.67195</span>
<span class="co">#&gt; 13dc78   ca432a  1   0.67195</span>
<span class="co">#&gt; 13dc78   e45c54  1   0.67195</span>
<span class="co">#&gt; 9c0e59   80afad  1   0.6355</span>
<span class="co">#&gt; 6ddfa3   a7a903  1   0.704755</span>
<span class="co">#&gt; 3301f4   7ba446  1   0.55</span>
<span class="co">#&gt; 3301f4   03eee3  1   0.55</span>
<span class="co">#&gt; 3301f4   6d4b91  1   0.55</span>
<span class="co">#&gt; 3301f4   881955  1   0.55</span>
<span class="co">#&gt; 3301f4   3e93ce  1   0.55</span>
<span class="co">#&gt; 3301f4   ad208a  1   0.55</span>
<span class="co">#&gt; 3301f4   958de8  1   0.55</span>
<span class="co">#&gt; 3301f4   7d21f1  1   0.55</span>
<span class="co">#&gt; 874918   cede47  1   0.6355</span>
<span class="co">#&gt; 874918   82b4fc  1   0.6355</span>
<span class="co">#&gt; 874918   732379  1   0.6355</span>
<span class="co">#&gt; 874918   9199be  1   0.6355</span>
<span class="co">#&gt; f46d1e   7d3df0  1   0.6355</span>
<span class="co">#&gt; 0b6e5a   13dc78  1   0.6355</span>
<span class="co">#&gt; c190fa   48f980  1   0.55</span>
<span class="co">#&gt; 337cac   c77a84  1   0.6355</span>
<span class="co">#&gt; 337cac   6f5824  1   0.6355</span>
<span class="co">#&gt; 03eee3   0b6e5a  1   0.595</span>
<span class="co">#&gt; c1dc98   76a432  1   0.64765</span>
<span class="co">#&gt; c1dc98   81e071  1   0.64765</span>
<span class="co">#&gt; a7a903   3b712b  1   0.734279</span>
<span class="co">#&gt; d2d08f   cd48bf  1   0.55</span>
<span class="co">#&gt; 030327   1e7431  1   0.64765</span>
<span class="co">#&gt; 030327   37aad9  1   0.64765</span>
<span class="co">#&gt; 6d4b91   9c0e59  1   0.595</span>
<span class="co">#&gt; 76a432   44060b  1   0.682885</span>
<span class="co">#&gt; 76a432   905296  1   0.682885</span>
<span class="co">#&gt; 76a432   f951d8  1   0.682885</span>
<span class="co">#&gt; 76a432   b4e5d5  1   0.682885</span>
<span class="co">#&gt; 7fa3b1   1b55d2  1   0.6355</span>
<span class="co">#&gt; f83f2e   a6fcaf  1   0.6355</span>
<span class="co">#&gt; 881955   642cb4  1   0.595</span>
<span class="co">#&gt; 881955   2afba4  1   0.595</span>
<span class="co">#&gt; 881955   f46d1e  1   0.595</span>
<span class="co">#&gt; 881955   7fa3b1  1   0.595</span>
<span class="co">#&gt; e42c72   4e8dc8  1   0.6355</span>
<span class="co">#&gt; 4df851   4e2918  1   0.595</span>
<span class="co">#&gt; d4d75e   7be343  1   0.6355</span>
<span class="co">#&gt; 7be343   24876f  1   0.67195</span>
<span class="co">#&gt; 735807   0fffca  1   0.64765</span>
<span class="co">#&gt; 238842   2afba4  1   0.55</span>
<span class="co">#&gt; 238842   7d21f1  1   0.55</span>
<span class="co">#&gt; 3e93ce   09f4a0  1   0.595</span>
<span class="co">#&gt; f7fc94   963c41  1   0.682885</span>
<span class="co">#&gt; 8e02f0   38881f  1   0.6355</span>
<span class="co">#&gt; 8e02f0   d81c17  1   0.6355</span>
<span class="co">#&gt; 8e02f0   1569a5  1   0.6355</span>
<span class="co">#&gt; 8e02f0   064974  1   0.6355</span>
<span class="co">#&gt; 8e02f0   161814  1   0.6355</span>
<span class="co">#&gt; 8e02f0   c09e12  1   0.6355</span>
<span class="co">#&gt; b16cf0   51ca98  1   0.64765</span>
<span class="co">#&gt; 51ca98   b08945  1   0.682885</span>
<span class="co">#&gt; 51ca98   f80b2e  1   0.682885</span>
<span class="co">#&gt; 81e071   80afad  1   0.665268</span>
<span class="co">#&gt; 81e071   35a9b6  1   0.665268</span>
<span class="co">#&gt; 81e071   6e0643  1   0.665268</span>
<span class="co">#&gt; 81e071   efee6b  1   0.665268</span>
<span class="co">#&gt; 81e071   252679  1   0.665268</span>
<span class="co">#&gt; dc72e8   f59e4b  1   0.714597</span>
<span class="co">#&gt; 4e2918   ef7028  1   0.6355</span>
<span class="co">#&gt; 2fabc7   dc72e8  1   0.682885</span>
<span class="co">#&gt; ad208a   8e02f0  1   0.595</span>
<span class="co">#&gt; 48f980   d4d75e  1   0.595</span>
<span class="co">#&gt; 24dba7   1f4d22  1   0.682885</span>
<span class="co">#&gt; 327734   486c07  1   0.67195</span>
<span class="co">#&gt; 4e8dc8   6ddfa3  1   0.67195</span>
<span class="co">#&gt; 206e37   24dba7  1   0.64765</span>
<span class="co">#&gt; 958de8   f60e85  1   0.621325</span>
<span class="co">#&gt; 2d3187   337cac  1   0.595</span>
<span class="co">#&gt; 7d21f1   030327  1   0.6085</span>
<span class="co">#&gt; 7d21f1   735807  1   0.6085</span>
<span class="co">#&gt; 7d21f1   81e071  1   0.6085</span></code></pre></div>
<p>Now we are ready to draw lots of isolates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># leaf nodes</span>
sg_sinks &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sinks.html">sinks</a></span>(sent_graph2)
<span class="co"># 20 samples from each sink node</span>
<span class="kw"><a href="../reference/draw_isolates.html">draw_isolates</a></span>(sg_net_dir, <span class="kw">data.frame</span>(sg_sinks, <span class="kw">rep</span>(<span class="dv">20</span>, <span class="kw">length</span>(sg_sinks))))
<span class="co">#&gt;      node allele_0 allele_1 allele_2</span>
<span class="co">#&gt; 1  acf7bb        0        0       20</span>
<span class="co">#&gt; 2  9f5aad        0        0       20</span>
<span class="co">#&gt; 3  0b57e4        0        0       20</span>
<span class="co">#&gt; 4  78e5ba       20        0        0</span>
<span class="co">#&gt; 5  ca432a       20        0        0</span>
<span class="co">#&gt; 6  e45c54       20        0        0</span>
<span class="co">#&gt; 7  80afad        0        3       17</span>
<span class="co">#&gt; 8  cede47        0        0       20</span>
<span class="co">#&gt; 9  82b4fc        0        0       20</span>
<span class="co">#&gt; 10 732379        0        0       20</span>
<span class="co">#&gt; 11 9199be        6        0       14</span>
<span class="co">#&gt; 12 7d3df0        1        0       19</span>
<span class="co">#&gt; 13 c77a84        0       20        0</span>
<span class="co">#&gt; 14 6f5824        7       13        0</span>
<span class="co">#&gt; 15 3b712b        0        0       20</span>
<span class="co">#&gt; 16 1e7431        0        0       20</span>
<span class="co">#&gt; 17 37aad9        0        0       20</span>
<span class="co">#&gt; 18 44060b       20        0        0</span>
<span class="co">#&gt; 19 905296       20        0        0</span>
<span class="co">#&gt; 20 f951d8       20        0        0</span>
<span class="co">#&gt; 21 b4e5d5       20        0        0</span>
<span class="co">#&gt; 22 1b55d2        0        0       20</span>
<span class="co">#&gt; 23 a6fcaf        0       20        0</span>
<span class="co">#&gt; 24 24876f        0        0       20</span>
<span class="co">#&gt; 25 0fffca        0        1       19</span>
<span class="co">#&gt; 26 09f4a0        0       20        0</span>
<span class="co">#&gt; 27 38881f        1        0       19</span>
<span class="co">#&gt; 28 d81c17       15        0        5</span>
<span class="co">#&gt; 29 1569a5        0        0       20</span>
<span class="co">#&gt; 30 064974        1        0       19</span>
<span class="co">#&gt; 31 161814       18        0        2</span>
<span class="co">#&gt; 32 c09e12        2        0       18</span>
<span class="co">#&gt; 33 b08945        0        0       20</span>
<span class="co">#&gt; 34 f80b2e        0        0       20</span>
<span class="co">#&gt; 35 35a9b6       19        0        1</span>
<span class="co">#&gt; 36 6e0643        9        0       11</span>
<span class="co">#&gt; 37 efee6b        2        0       18</span>
<span class="co">#&gt; 38 252679        7        0       13</span>
<span class="co">#&gt; 39 f59e4b        0        0       20</span>
<span class="co">#&gt; 40 ef7028       10       10        0</span>
<span class="co">#&gt; 41 1f4d22        6        0       14</span>
<span class="co">#&gt; 42 486c07        0        0       20</span></code></pre></div>
</div>
</div>
<div id="multiple-runs-and-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#multiple-runs-and-analysis" class="anchor"></a>Multiple runs and analysis</h1>
<p>A single simulation is not particularly interesting. In this section we will therefore run a whole set of simulations and do some basic analysis on the results.</p>
<p>As a simple example we will try to find out whether topological distance between nodes on the network results in a corresponding genetic distance when looking at the genetic composition of the nodes’ pathogen population.</p>
<p>For the sake of simplicity we will use a simple binary tree for this example. Note that for maximum flexibility <code>perfect_binary</code> creates an edge list, <em>not</em> a <code>popsnetwork</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate network</span>
tree &lt;-<span class="st"> </span><span class="kw"><a href="../reference/perfect_binary.html">perfect_binary</a></span>(4L)</code></pre></div>
<p>We measure genetic distance between two samples as the Hamming distance of their genomes and the genetic distance between two nodes as the genetic distance of two random isolates drawn from these nodes.</p>
<p>By default rpathsonpaths only simulates single loci. This would result in all genetic distance measurements to be either <code>0</code> or <code>1</code>, which is not very useful for statistical analysis. It is quite simple, however, to emulate multiple loci - simply run the same scenario multiple times and collate the results (note that this assumes that there is no linkage disequilibrium).</p>
<p>We first have to generate initial allele frequencies for each locus.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate a list of random allele frequencies</span>
<span class="co"># these are the initial allele frequency distributions at 10 "loci"</span>
all_freqs &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">10</span>, <span class="kw">list</span>(<span class="dv">0</span>, gtools::<span class="kw">rdirichlet</span>(<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))), <span class="dt">simplify=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><code>run_popsnet</code> is a convenience frontend for <code>popsnetwork</code>, <code>set_allele_freqs</code> and the <code>popgen_*</code> simulator functions. It makes it straightforward to run a large set of simulations on the same network topology. Note that, since the function calls <code>popsnetwork</code>’s contructor itself, the network has to be provided in edgelist format. The result of a call to <code>run_popsnet</code> is a simple list containing the raw network object (as produced by the contructor) and a vector of network objects containing the simulation data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># now we can run the simulation</span>
<span class="co"># since all_freqs is a list the simulation will be run n (in this case 1) times</span>
<span class="co"># per element</span>
results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_popsnet.html">run_popsnet</a></span>(tree, <span class="dt">ini_input=</span><span class="dv">1</span>, <span class="dt">ini_infd=</span><span class="fl">0.5</span>, 
                       <span class="dt">ini_freqs=</span>all_freqs, <span class="dt">n=</span>1L, <span class="dt">theta=</span><span class="fl">0.1</span>,
                       <span class="co"># we use the Dirichlet model</span>
                       <span class="dt">spread_model=</span><span class="st">"fluid"</span>, <span class="dt">drift_model=</span><span class="st">"dirichlet"</span>)</code></pre></div>
<p>Now we have to do something with the results. We will first obtain topological distances using rpathsonpaths’ <code>path_distances</code> function. Since in our simple scenario infection cases equal leaf nodes of the network we keep only the distances between all leaf nodes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># $raw contains the pre-simulation net</span>
raw &lt;-<span class="st"> </span>results$raw
<span class="co"># we need those since we are only interested in leaf nodes</span>
snks &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw"><a href="../reference/sinks.html">sinks</a></span>(<span class="kw"><a href="../reference/edge_list.html">edge_list</a></span>(raw)))
<span class="co"># get topological distances of all pairs of leaf nodes</span>
path_dists &lt;-<span class="st"> </span><span class="kw"><a href="../reference/path_distances.html">path_distances</a></span>(raw)[snks, snks]</code></pre></div>
<p>Next we determine genetic distances. The builtin function <code>distances_sample</code> does most of the heavy lifting for us. It draws a random isolate from each node and calculates Hamming distance for each pair of nodes. As before we throw away everything but the leaf nodes. This will give us a matrix of 1s and 0s for each of the simulations, which - as we said before - correspond to one locus each. We simply sum all results to obtain genetic distance over the whole genome.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the actual results</span>
res &lt;-<span class="st"> </span>results$result
<span class="co"># this runs distances_sample on each of the networks in the results and sums</span>
<span class="co"># up the results</span>
gene_dists &lt;-<span class="st"> </span><span class="kw">Reduce</span>(<span class="st">'+'</span>, <span class="kw">lapply</span>(res, function(x) <span class="kw"><a href="../reference/distances_sample.html">distances_sample</a></span>(x)[snks, snks]))</code></pre></div>
<p>Now we can plot genetic versus topological distance and the resulting correlation. As we can see there is a clear correlation between topological and genetic distance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">x=</span><span class="kw">jitter</span>(<span class="kw">as.vector</span>(path_dists), <span class="fl">0.1</span>), <span class="dt">y=</span><span class="kw">jitter</span>(<span class="kw">as.vector</span>(gene_dists), <span class="fl">0.02</span>), <span class="dt">xlab=</span><span class="st">"topological"</span>, <span class="dt">ylab=</span><span class="st">"genetic"</span>)
<span class="kw">abline</span>(<span class="kw">lm</span>(<span class="kw">as.vector</span>(gene_dists)~<span class="kw">as.vector</span>(path_dists)), <span class="dt">col=</span><span class="st">"red"</span>)</code></pre></div>
<p><img src="figs-overview/unnamed-chunk-15-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#installing-the-package">Installing the package</a></li>
      <li><a href="#what-does-it-do">What does it do?</a></li>
      <li>
<a href="#a-quick-overview">A quick overview</a><ul class="nav nav-pills nav-stacked">
<li><a href="#preparing-the-network">Preparing the network</a></li>
      <li><a href="#injecting-initial-populations-and-simulating-spread">Injecting initial populations and simulating spread</a></li>
      <li><a href="#drawing-samples">Drawing samples</a></li>
      </ul>
</li>
      <li>
<a href="#an-example-using-real-data">An example using real data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#obtain-and-clean-up-data">Obtain and clean up data</a></li>
      <li><a href="#create-network">Create network</a></li>
      <li><a href="#run-simulation">Run simulation</a></li>
      </ul>
</li>
      <li><a href="#multiple-runs-and-analysis">Multiple runs and analysis</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Martin Hinsch.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
